<script>
function setRefineCounter(){
  $('.has-children').each(function(){
    var childArray = $(this).children('ul').children();
    $(this).children('.refine').text('Refine (' + childArray.length + ')')
  })
}

function resetFilters() {
  $('.selected').removeClass('selected');
  $('#id-7-4-1 .selectable').addClass('selected');
  $('#filtersCounter').removeClass('show-counter');
  $('#filtersCounter').text('');
}


function hideJobPanel() {
  $('.filters-wrapper').removeClass('shrunk');
  $('#jobPanel').removeClass('showPanel');
  $('#jobPanel').children().remove();
  $('.with-panel').removeClass('with-panel');
}

function showJobPanel(el) {
  if (! $(el).closest("#jobPanel").length ) {
    $('.with-panel').removeClass('with-panel');
    $(el).parent('.job').addClass('with-panel');
    $('#jobPanel .job').remove();
    $('.filters-wrapper').addClass('shrunk');
    $('#jobPanel').addClass('showPanel');
    $(el).parent('.job').clone().appendTo('#jobPanel');
    lipsum = new LoremIpsum();
    var expandedDesc =  lipsum.generate(500) ;
    $('#jobPanel .desc').append( '<p>' + expandedDesc + '</p>');
    $('#jobPanel').animate({ scrollTop: 0 }, "fast")
    //attach the function to undo the shrinking
    $(".shrunk .filters-header").click(function() {
      hideJobPanel();
    });

  }
}


function refreshPage(){

  var numJobs = 15;

  $('#dummyjobs .job').remove();
  $('#dummyjobs .message').remove();
  lipsum = new LoremIpsum();
  
  var titles = ["Project manager", "Coordinator", "Social Worker", "Nurse", "Head of Operations", "Director of Finance", "CEO", "Executive Assistant", "Trustee", "Policy Researcher", "Campaign Manager"];
  var orgs = ["Oxfam", "CAFOD", "NCVO", "Save the Children", "Amnesty International", "The Cotton Tree Trust", "GL11 Community Hub", "MediCinema", "Cranstoun"];
  var locs = ["London", "Manchester", "Glasgow", "Liverpool", "Brighton", "Bristol", "Cardiff", "Norwich", "Kingston", "Working from home", "Belfast"];
  var sals = ["7,500 - 8,200", "23,000 - 27,000", "28,320 - 31,235", "31,540 - 36,740", "35,675 - 41,295", "41,200 - 45,300", "45,000 - 52,000", "49,853 - 56,783", "56,766 - 68,575", "61,987 - 83,789", "71,654 - 93,839", "85,823 - 102,943", "128,303 - 156,218"];
  var cons = ["Permanent", "Part-time", "Temporary", "Contract"];
  var times = ["today", "today", "today", "today", "today", "yesterday", "yesterday", "2 days ago", "3 days ago", "4 days ago", "5 days ago"];

  //var html = '<h4 class="message"> Found ' + Math.floor(Math.random()*20000) + ' jobs.</h4>';
  var html = '';
  for (var j=0; j <= numJobs; j++){
    var title = titles[Math.floor(Math.random()*titles.length)];
    var org = orgs[Math.floor(Math.random()*orgs.length)];
    var postDate = times[Math.floor(Math.random()*times.length)];
    var loc = locs[Math.floor(Math.random()*locs.length)];
    var sal = sals[Math.floor(Math.random()*sals.length)];
    var con = cons[Math.floor(Math.random()*cons.length)];
    var desc = lipsum.generate(20);
    html += '<div class="job">' +
              '<div onclick="showJobPanel(this)" class="job-title">' + title + '</div>' +
              '<div class="job-org"> Posted by <span class="org">' + org + '</span> ' + postDate + '.</div>' +
              '<div class="meta">' + 
                '<div class="loc"><i class="fa fa-map-marker-alt"></i>' + loc + '</div>' +
                '<div class="sal"><i class="fa fa-pound-sign"></i>' + sal + '</div>' +
                '<div class="con"><i class="fa fa-briefcase"></i>' + con + '</div>' +
              '</div>' +
              '<div class="desc">' + desc + '</div>' +
            '</div>';  
  }
  $('#dummyjobs').append(html);
}

  

  
//actions after click on one of the rounded ticks
$( ".selectable" ).click(function() {
    
  //update the class of the clicked option
  $(this).toggleClass('selected');
  $(this).siblings('.show').removeClass('show');
    
  var selArray = $('.selected');
  var selNum = selArray.length - 1;
  if (selNum == 0) {
    $('#filtersCounter').removeClass('show-counter');
    $('#filtersCounter').text('');
  } else {
    $('#filtersCounter').addClass('show-counter');
    $('#filtersCounter').text(selNum);
  }
    
    
  refreshPage();
    
});


jQuery(document).ready(function(){
  setRefineCounter();             
});

</script>